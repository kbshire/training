# NAT

网络地址转换NAT（Network Address Translation）是将IP数据报文头中的IP地址转换为另一个IP地址的过程。



目的

随着Internet的发展和网络应用的增多，IPv4地址枯竭已成为制约网络发展的瓶颈。尽管IPv6可以从根本上解决IPv4地址空间不足问题，但目前众多网络设备和网络应用大多是基于IPv4的，因此在IPv6广泛应用之前，一些过渡技术（如CIDR、私网地址等）的使用是解决这个问题最主要的技术手段。NAT主要用于实现内部网络（简称内网，使用私有IP地址）访问外部网络（简称外网，使用公有IP地址）的功能。当内网的主机要访问外网时，通过NAT技术可以将其私网地址转换为公网地址，可以实现多个私网用户共用一个公网地址来访问外部网络，这样既可保证网络互通，又节省了公网地址。私网地址的类型和分类请参见[IPv4地址](mk:@MSITStore:D:\A_学习\产品文档\AR2200.chm::/dc/dc_fd_IPv4_0005.html)。



受益

作为减缓IP地址枯竭的一种过渡方案，NAT通过地址重用的方法来满足IP地址的需要，可以在一定程度上缓解IP地址空间枯竭的压力。NAT除了解决IP地址短缺的问题，还带来了两个好处：

- 有效避免来自外网的攻击，可以很大程度上提高网络安全性。
- 控制内网主机访问外网，同时也可以控制外网主机访问内网，解决了内网和外网不能互通的问题。



缺陷： 1.极其消耗网络设备资源(需查看NAT映射表转发影响效率) 

2.破坏了数据的端到端传输（导致有些安全技术无法有效实施）



NAT分类

静态nat

动态nat

easy ip

nat server







静态nat

静态NAT设置起来最为简单和最容易实现的一种，内部网络中的每个主机都被永久映射成外部网络中的某个合法的地址。他并不能节约IP地址

动态nat

多对多转换 ，通过定义地址池来实现，也不能解决ip地址短缺的问题

![image-20230323112755530](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230323112755530.png) 

easyip

多对一转换，可以把多个地址转为一个地址，通过端口号区分

![image-20230323112742939](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230323112742939.png) 

nat server

NAT具有“屏蔽”内部主机的作用，但有时内网需要向外网提供服务，比如提供WWW服务或者FTP服务。这种情况下需要内网的服务器不被“屏蔽”，外网用户可以随时访问内网服务器。

![image-20230323112853592](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230323112853592.png) 







也可以分为SNAT，DNAT，双向nat



NAT ALG (Application Level Gateway，应用级网关)是特定的应用协议的转换代理,可以完成应用层数据中携带的地址及端口号信息的转换。

NAT和NAPT只能对IP报文的头部地址和TCP/UDP头部的端口信息进行转换。对于一些特殊协议，例如FTP等，它们报文的数据部分可能包含IP地址信息或者端口信息，这些内容不能被NAT有效的转换。解决这些特殊协议的NAT转换问题的方法就是在NAT实现中使用应用层网关ALG（Application Level Gateway）功能。ALG是对特定的应用层协议进行转换，在对这些特定的应用层协议进行NAT转换过程中，通过NAT的状态信息来改变封装在IP报文数据部分中的特定数据，最终使应用层协议可以跨越不同范围运行。

ALG支持的协议有DNS，FTP，PPTP等





双向nat通过snat+nat server实现

用于服务器没有配置网关的时候使用或服务器有多片网卡时

 ![image-20230323113442427](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230323113442427.png)