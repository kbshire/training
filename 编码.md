# 编码

编码本质上是信息形式的转化。编码的目的不是为了加密信息，将数据转化成某种固定的格式的编码信息，方便不同系统间的传输，通过解码编码信息可以得到原始信息。

编码：将字符串序列化为字节序列
解码：从字节序列重建字符串

### ASCII

ASCII：（美国信息交换标准代码）是基于拉丁字母的一套电脑编码系统。它主要用于显示现代英语和其他西欧语言。

ASCII字符集：主要包括控制字符（回车键、退格、换行键等）；可显示字符（英文大小写字符、阿拉伯数字和西文符号）。

ASCII字符编码：将ASCII字符集转换为计算机可以接受的数字系统的数的规则。使用7位（bits）表示一个字符，共128字符；但是7位编码的字符集只能支持128个字符。（0000000-1111111）

缺点：ASCII的局限在于只能显示26个基本拉丁字母、阿拉伯数字和英式标点符号，因此只能用于显示现代美国英语。

扩展ASCII 字符是从128 到255（0x80-0xff）的字符。许多基于x86的系统都支持使用扩展（或“高”）ASCII。它将每个字符的第8 位用于确定附加的128 个特殊符号字符、外来语字母和图形符号。**针对扩展的ASCII码，不同的国家有不同的字符集，所以它并不是国际标准。**

![在这里插入图片描述](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/20200326185233658.jpg)



### Latin1

​      Latin1字符集属于扩展ASCII码的一种，它把位于128-255之间的字符用于拉丁字母表中特殊语言字符的编码，也因此而得名。不过欧洲语言不是地球上的唯一语言，亚洲和非洲语言并不能被Latine1字符集所支持。

mysql默认为latin1的编码



### Unicode

​    Unicode（统一码、万国码、单一码）是一种在计算机上使用的字符编码。Unicode 是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。1990年开始研发，1994年正式公布。

​    Unicode是国际组织制定的可以容纳世界上所有文字和符号的字符编码方案，用数字0-0x10FFFF来映射这些字符，最多可以容纳1114112个字符，或者说有1114112个码位。码位就是可以分配给字符的数字，UTF-8，UTF-16，UTF-32都是将数字转换到程序数据的编码方案。

​    Unicode其实是Latin1的扩展。只有一个低字节的Uncode字符其实就是Latin1字符。所以Unicode字符集也兼容ASCII字符。

### utf   

UTF( Unicode Transformation Format )只是一种针对Unicode的编码方式，没有像Unicode那样存在字符与数字之间的对应关系。它的出现只是为了解决Unicode的不足。比如：

- 存储问题。事实证明，对可以用ASCII表示的字符使用UNICODE并不高效，因为Unicode比ASCII占用大一倍的空间，而对ASCII来说高字节的0对他毫无用处。UTF-8可以解决这个问题，因为它是一种变长字节的编码。比如0-127的Unicode字符（ASCII字符）转为UTF-8只需要一个字节。

- 传输问题。计算机分为大端机和小端机。Unicode用至少两个字节的整数来表示一个字符，这个整数在大端机和小端机上字节顺序是相反的，所以给传输带来了巨大的问题。UTF-8很好的解决了这个问题，因为它是字节顺序无关的，在所有机器上表示都一样（至于为什么一样看一下后面的转换关系就会一目了然）。**不过UTF-16和UTF-32也有大小端的问题。这也是为什么UTF-8使用较为普遍的原因。**

```
UTF-8以字节为编码单元因此不需要 BOM 来表明字节顺序，但可以用 BOM 来表明编码方式。字符 "Zero Width No-Break Space" 的 UTF-8 编码是 EF BB BF。所以如果接收者收到以 EF BB BF 开头的字节流，就知道这是 UTF-8编码了。

因此UTF-8编码的字符串开头处的三个bytes 0xef,0xbb,0xbf就称为UTF-8 BOM头。

类似WINDOWS自带的记事本等软件，在保存一个以UTF-8编码的文件时，会在文件开始的地方插入UTF-8 BOM头。记事本等编辑器通过它来识别这个文件是否以UTF-8编码(当然即便没有UTF-8 BOM头记事本也能通过其它方式正确识别UTF-8编码)。

那么如果一个UTF-8编码的字符串的开头处没有BOM头又会发生什么？
比如我们用C#创建一个csv文件，里面保存中文，日文等多国语言的字符串然后以UTF-8编码保存(此时没有UTF-8 BOM头)。
记事本能够识别，但是excel却识别出错：
这是一个已知的问题，Excel打开没有BOM头的csv文件时就是会这样！
解决的办法也很简单，在生成字符串时手动把UTF-8 BOM头添加在字符串的开头处，下面是C#代码：
sb.Append('\uFEFF');
```





### gb2312

《信息交换用汉字编码字符集》是由中国国家标准总局1980年发布，1981年5月1日开始实施的一套国家标准，标准号是GB2312—1980。GB就是拼音guobiao的简称。适用于汉字处理、汉字通信等系统之间的信息交换，通行于中国大陆；新加坡等地也采用此编码。中国大陆几乎所有的中文系统和国际化的软件都支持GB2312。基本集共收入汉字6763个和非汉字图形字符682个。

GB2312采用双字节编码。所有字符集分成94个区，每区有94个位。每个区位上只有一个字符，因此可用所在的区和位来对汉字进行编码，称为区位码。把十六进制的区位码加上0x2020，就得到国标码。国标码加上0x8080，就得到常用的计算机机内码。所以区位码加上0xA0A0就得到了计算机内码。什么是计算机内码呢，通俗的将就是存储字符时在内存里面的整数。下面举个例子。

汉字“啊”是GB2312字符集中的第一个汉字，它的区位码为0x1001。如下图：



### gbk

​	 GBK全称是《汉字内码扩展规范》，K应该是Kuo的首字母。它是1995年12月1日制订的，从时间上来看比GB2312晚了15年。为什么要制定这个字符集呢？大家很容易想到。GB2312有很多空余的位根本没有被使用，表示的汉子也只有区区6763个，这明显不足。

​    GBK共收录了21003个汉字，完全兼容GB2312字符。比如“啊”在GBK中的编码还是0xB0A1。而且GBK不像B2312那样存在区位码与内码的区分。它的字符编码和在内码是相同的。

​    GBK是如何兼容GB2312的呢？相信大家很容易理解。还是以“啊”为例。它在GB2312中的内码是0xB0A1，把它直接填到GBK编码表中的相应位置即可。

​    目前中文版的WIN95、WIN98、WINDOWS NT以及WINDOWS 2000、WINDOWS XP、WIN 7等都支持GBK编码方案。



### gbk导致的宽字节注入

**导致原因： mysql_query("set names gbk") 错误使用了编码方式 gbk**

一个 gbk 编码汉字，占用 2 个字节。一个 utf-8 编码的汉字，占用 3 个字节。 假设我们有以下代码，并且我们的 magic_quotes_gpc 是关闭的

```
<?php
//连接数据库部分，注意使用了gbk编码，把数据库信息填写进去
$conn = mysql_connect('localhost', 'root', 'toor!@#$') or die('bad!');
mysql_query("SET NAMES 'gbk'");
mysql_select_db('test', $conn) OR emMsg("连接数据库失败，未找到您填写的数据库");
//执行sql语句
$id = isset($_GET['id']) ? addslashes($_GET['id']) : 1;
$sql = "SELECT * FROM news WHERE tid='{$id}'";
$result = mysql_query($sql, $conn) or die(mysql_error()); //sql出错会报错，方便观察
?>
```

mysql 在使用 GBK 编码的时候，会认为两个字符是一个汉字（前一个 ascii 码要大于 128，才到汉字的范围）。如果我们输入 %df' 看会怎样： 

You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ''111ß\''' at line 1 

此时出现报错，说明存在注入

这就是 mysql 的特性，因为 gbk 是多字节编码，他认为两个字节代表一个汉字，所以 %df 和后面的 addslash 加的 \ 也就是 %5c 变成了一个汉字 運 ，而 ' 逃逸了出来。

但如果我们把 gbk 换成 gb2312，我们的 %df%5c%27 又不能注入了 这归结于 gb2312 编码的取值范围。它的高位范围是 0xA1~0xF7 ，低位范围是 0xA1~0xFE ，而 \ 是 0x5c，是不在低位范围中的。所以， 0x5c 根本不是 gb2312 中的编码，所以自然也是不会被吃掉的。

为了解决宽字节注入，有些 cms 会用 mysql_real_escape_string 抵御，但如果我们去使用 % df，他依然会被打穿 

原因就是，你没有指定 php 连接 mysql 的字符集。我们需要在执行 sql 语句之前调用一下 mysql_set_charset 函数，设置当前连接的字符集为 gbk。 

```
//修复方案1
mysql_query("SET NAMES 'gbk'");
mysql_real_escape_string
```

```
//修复方案2
//只需在所有sql语句前指定一下连接的形式是二进制：
SET character_set_connection=gbk, character_set_results=gbk,character_set_client=binary
```

### hex 

又称Base16编码，是一种十六进制编码，将每一个字节表示的十六进制表示的内容，用字符串来显示。

Hex编码就是把一个8位的字节数据用两个十六进制数展示出来，编码时，将8位二进制码重新分组成两个4位的字节，其中一个字节的低4位是原字节的高四位，另一个字节的低4位是原数据的低4位，高4位都补0，然后输出这两个字节对应十六进制数字作为编码。

```
ASCII码：A (65)
二进制码：0100_0001
重新分组：0000_0100 0000_0001
十六进制：        4         1
Hex编码：41
```



### base64

是一种基于64个可打印字符来表示二进制数据的表示方法。常用于在通常处理文本数据的场合，表示、传输、 存储一些二进制数据，包括MIME的电子邮件及XML的一些 复杂数据。

由于2^6=64，所以每6个比特为一个单元，对应某个可打印字符。3个字节有24个比特，对应于4个Base64单元，即3个字节可由4个可打印字符来表示。在Base64中的可打印字符包括字母A-Z、a-z、数字0-9，这样共有62个字符，此外两个可打印符号在不同的系统中而不同，一般为+和/。

Base64编码要求把3个8位字节（3*8=24）转化为4个6位的字节（4*6=24），之后在6位的前面补两个0，形成8位一个字节的形式。 如果剩下的字符不足3个字节，则用0填充，输出字符使用'='，因此编码后输出的文本末尾可能会出现1或2个'='。

[Base64编码/解码器，在线解码Base64 (sojson.com)](https://www.sojson.com/base64.html)编解码网站

[Base64 编码/解码 - 在线工具 (toolhelper.cn)](https://www.toolhelper.cn/EncodeDecode/Base64EncodeDecode)编码表

![image-20230327110722335](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230327110722335.png) 





# 加密

加密是为了数据的保密性，防止用户的数据被窃取或泄露；保证数据的完整性，防止用户传输的数据被篡改；确认通信双方的身份，确保数据来源与合法的用户。加密的专注点不在可用性上，在于保证数据安全传输，使得其他人不能获取的具体信息内容。这点和编码有明显的区别。

加密：把明文通过密钥，转换为难以理解的数据(密文)的过程。 

解密：把难以理解的数据(密文)转换为明文的过程。



加密一般分为对称加密和非对称加密



### 对称加密

加密又分为对称加密和非对称加密，区别在于在加密和解密信息时秘钥是不是同一个。

常见的对称加密：DES、3DES、AES、RC5、RC6......

DES：是一种分组密码，以64位为分组对数据加密，它的密钥长度是56位，加密解密用同一算法。

3DES：是基于DES的对称算法，对一块数据用三个不同的密钥进行三次加密，强度更高。

AES：是密码学中的高级加密标准，该加密算法采用对称分组密码体制，具有更好的安全性和灵活性。

![image-20230327110919220](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230327110919220.png) 



### 非对称加密

1.数据加密过程：使用公钥对数据进行加密得到密文。

2.数据解密过程：使用私钥对数据进行解密得到原数据

常见的非对称加密：RSA，ECC

RSA：是目前最有影响力的公钥加密算法，并且被普遍认为是目前最优秀的公钥方案之一。RSA是第一个能同时用于加密和数字签名的算法。

ECC：它比其他的方法使用更小的密钥，不过一个缺点是加密和解密操作 的实现比其他机制时间长 (相比 RSA 算法，该算法对 CPU 消耗严重)。

![image-20230327111131081](https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230327111131081.png) 





# hash 

常见Hash算法：MD5，SHA-1

Hash算法特性：
1.压缩性：任意长度的数据，算出的摘要长度都固定。

2.正向快速：在有限时间和有限资源内可以快速计算出Hash值

3.抗修改性：对原数据进行任何改动，哪怕只修改1个字节，所得到的摘要都有很大区别。

4.弱抗碰撞：已知原数据和其摘要，想找到一个具有相同摘要的数据（即伪造数据），在计算上是困难的。

5.强抗碰撞：想找到两个不同的数据，使它们具有相同的摘要，在计算上是困难的。

MD5：用的是哈希函数，它的典型应用是对一段信息产生信息摘要，以防止被篡改。MD5在计算过程中原文的部分信息是丢失了的，所以MD5不可逆，不属于加密而是摘要算法。

MD5算法的原理可简要的叙述为：MD5以512位分组来处理输入的信息，且每一分组又被划分为16个32位子分组，经过了一系列的处理后，算法的输出由四个32位分组组成，将这四个32位分组级联后将生成一个128位散列值(通常用16进制表示为32个字符)。

彩虹表：它是一个用于加密散列函数逆运算的预先计算好的表, 为破解密码的散列值（或称哈希值、微缩图、摘要、指纹、哈希密文）而准备。





### 数字签名

数字签名技术是将原文通过特定HASH函数得到的摘要信息用发送者的私钥加密，与原文一起传送给接收者。接收者只有用发送者的公钥才能解密被加密的摘要信息，然后用HASH函数对收到的原文提炼出一个摘要信息，与解密得到的摘要进行对比。