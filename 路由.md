# 路由

路由从种类上可以分为静态路由和动态路由。静态路由就是需要手工配置指定出接口和下一跳的路由，这也可以称为是最灵活的路由。

动态路由指的是通过一些算法完成自动收敛的路由协议。比如OSPF，ISIS就是通过SPF，最短路径算法，而RIP则是通过Bellham-Ford算法。

动态路由分类方式很多，我们可以基于使用范围分类。可以分成IGP和BGP。IGP指的是在同一个AS内使用的协议。BGP是在不同AS之间使用的路由协议。因此BGP能够承载的路由数目会比IGP来的更多。IGP中包含的路由协议有RIP，ISIS，OSPF，EIGRP。BGP中只包含了BGP。

我们也可以基于协议特点分类，这一般是对于IGP进行的分类。我们可以分为距离矢量型路由协议和链路状态型路由协议。距离矢量型路由协议包含RIP，EIGRP。链路状态型包含OSPF，ISIS

距离矢量路由协议和链路状态路由协议相比，前者是依照“传闻”来进行路由选择，而后者是每台路由器独立地计算最优路径。

每台运行了链路状态路由协议的路由器会和它的邻居建立邻接关系并且互相给自己的每个邻居发送LSA，LSA中包含了本地链路、链路状态、路由接口到链路的代价、链路连接的所有邻居等信息。当一台路由器收到了另一台路由器发送的LSA后，它会将其中信息复制一份放在自己的数据库中并继续将此信息发送给其他路由器。如果一切顺利的话，所有路由器的数据库都会一致。

1、距离矢量路由器发送它的整个路由表，而链路状态路由器仅仅发送有关它直连链路(邻居）的信息;

2、距离矢量路由器仅向这的邻居发送路由信息，而链路状态路由器向整个网络中的所有路由器发送邻居信息;

3、距离矢量路由器通过使用不同的Bellman-Ford算法，而后者则通常使用不同的Dijkstra算法。

4、距离矢量路由协议发送周期性更新、完整路由表更新（periodic & full )而链路状态路由协议更新是非周期性的（nonperiodic)，部分的（ partial)

也可以按照是否传递网络掩码来分类。这样可以范围有类别和无类别路由协议。

有类别路由协议只有ripv1，其余的路由协议都算无类别，即不传递网络掩码



## rip 

分为三个版本RIPV1 RIPV2（在IPV4中使用），RIPNG下一代版本（在IPV6中使用）

RIPV1：是一种有类别的距离矢量型(只传路由信息，道听途说型)路由协议

RIPV2：是一种无类别的距离矢量型路由协议

通过发送数据包进行路由信息的交互，request（请求）  response （响应）；

数据包封装基于UDP发送，端口号520（源和目标都是520）（RIPNG 521），周期性发送(保证rip可靠)，周期更新时间为 30 s ，RIPV2发送地址 224.0.0.9 （组播地址 ）（ RIPV1 使用255.255.255.255）；RIP AD100,metric 计算方式： 路由信息每经过一次路由器的转发，默认为0，metric值增加 1 ， 最大值15 ，16代表着不可达 。

1.同步更新问题----使用异步更新方式(更新前随机获得一个值x范围为0-0.15)，用x*30，30-30*x获得下一次更新时间 (25.5-30s)

2.水平分割机制（适合于所有的距离矢量型路由协议）通过一个接口接收的路由不能再通过该接口转发该路由，防环

\3. 思科：update 更新 30s / invalid 无效 180(标记死亡,死亡计时器)，向其他路由器发送毒化路由 / flush 刷新 240(删除路由,掩埋计时器) / hold down 抑制 (180-240)共进行60s

华为： 更新30s / 无效 180(删除路由，存入数据库，不活动路由表) / 垃圾回收计时器 180+120(在数据库中120秒，共300)

4.带毒性逆转的水平分割机制（适合于所有的距离矢量型路由协议）

毒化路由:下次周期更新时会发送一个cost=16的路由，使之后的路由删除该路由(路由中毒)

逆转水平分割:需要回复给发的路由器，确认不可达情况收到

总结：rip是一种不适合大型网络的协议，因为他最高只有15跳，并且只能通告主类路由。更大的问题是他收敛慢，当然这是对比其他路由协议的。

接下来是rip的基础配置

```
rip 1
version 2
net 10.0.0.0

验证:
display ip routing proto rip
```



## ospf

1.OSPF 是一种链路状态型协议

2.OSPF 传递的是 LSA(路由信息与拓扑信息) （链路状态通告)( 6种类型LSA 1 2 3 4 5 7）

3.OSPF 更新方式：触发更新（网络结构稳定不更新，发生改变发送信息）

4.OSPF 更新地址：224.0.0.5 224.0.0.6 (组播更新)

5.OSPF 支持区域划分(骨干，非骨干，特殊区域，向日葵)

6.OSPF 是一种比较消耗路由器资源的协议

7.协议封装： 基于IP协议封装，不可靠，协议号为89(描述上层使用协议)，协议号范围为0-255，TCP协议号6，UDP:17

ospf适合用于企业网，因为该协议使用广泛，现网案例较多，企业网管理人员对OSPF 的操作较为熟悉，交付难度相对较低。支持的网络类型丰富，可以适合于复杂的网络环境

```
ospf 1 
area 0
network 10.1.1.0 0.0.0.255
```





# isis

ISIS是工作在链路层上的网络层协议，可以独立于CLNP协议运行

ISIS协议的物理区域边界在链路上，物理区域和逻辑的区域是不一致的，ISIS区域ID无法区域骨干和非骨干区域，仅对物理区域进行标识

1.收敛速度快

2路由携带能力更强，没有复杂的LSA类型，支持路由条目多（虚拟系统、分片)(区域内路由，区域间路由，AS外部路由都由L1/L2的LSP进行携带，

相对于OSPF产生的LSA (3类、5类)的数量较少，LSDB同步效率更高，加快网络的收敛速度。

3.支持层次化部署(L1、L2)

4.基于二层的路由协议，通过 TLV扩展来支持不同的网络层协议（IP、IPv6、CLNP)

TLV:是一种协议报文的数据结构，让协议具备可扩展能力，在未来可以支持更多的特性扩展

T:属性类型 type(比如:认证

L;属性取值长度length

V:属性值,描述具体的含义

协议可以根据具体的实际情况去决定携带那些类型TLV，方便进行功能的协商以及功能的扩展。

*ISIS时独立工作在数据链路层之上的网络层路由协议，无需IP协议的支持，独立性更强。针对IPv4、IPv6、VLNP设计了丰富的TLV属性，一种协议一个进程就可以支持多种协议栈。

5.区域间的平滑迁移

6.区域的边界在链路上，路由器本身在一个区域中，方便扩展和改造，适用于业务变更频繁，扩容频繁的网络(运营商)

*综合说明:

1.可以将性能较差的网络末节使用RIP、静态路由、OSPF特殊区域、ISIS的L1区域

2.OSPF 支持的网络类型丰富，选路和路由控制更加的灵活，更适合层次化的网络划分，可以将性能好的路由器放置在骨干区域，性能一般的放置在普通区域，性能较差的放置在特殊区域来减轻设备性能压力，企业网应用较多

3.ISIS的收敛速度快，扩展性强，网络有更好的稳定性。虽然可以支持层次化网络划分，但是L1区域可能造成次优路径，需要对L1区域做路由泄露，所以ISIS 更适合扁平化全L2区域的网络部署,一般在运营商网络中应用较多

ISIS一般用在运营商的骨干网中，因为其承载路由数目多，收敛快，便于扩展啊

```
isis 1
network-entity 49.0001.0000.0000.0001.00
is-level level-2
cost-style wide
interface g1/0/0
isis enable 1
```





BGP

1.BGP是一种路径矢量型路由协议

2.BGP协议版本，当前版本V4（V4+）V1 V2(V1V2 EGP) V3（BGP有类别） V4（无类别 仅仅支持IPV4单播路由传递） V4+（支持IPV4单播路由、IPV6单播 IPV4 组播 、IPV6组播、VPNV4 、VPNV6 等，除了IPV4单播路由之外的其他的都称为 MP-BGP---多协议BGP； 注意：默认仅仅支持传递IPV4单播路由，传递其他方式路由时需要开启（激活）） 

3.更新地址：单播更新(基于建立TCP三次握手) 

4.更新方式：触发更新(有TCP保证可靠)、增量更新(只发送改变的路由信息)

5.BGP协议中存在大量的属性（是一种基于规则的路由协议）

6.BGP协议支持路由认证(在TCP头部之内认证，不在BGP内做)

7.支持BGP路由聚合（汇总）

8.BGP是一种非常消耗资源的路由协议

一个路由器只能运行一个BGP进程协议

BGP用于在as之间传递路由，并且易于扩展，可以承载vpnv4或者segmentrouting的流量

```
bgp 100
peer 10.1.12.2 as-number 200
peer 10.1.12.2 enable 
```

